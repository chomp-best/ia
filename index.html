<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estratega IA | Eliseo Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-font-smoothing: antialiased; }
        .apple-container { max-width: 500px; width: 100%; }
        .glass-panel { background: rgba(28, 28, 30, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 40px; }
        .input-dark { background: #000; border: 1px solid #1c1c1e; border-radius: 16px; transition: all 0.3s ease; }
        .input-dark:focus { border-color: #0071e3; outline: none; box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1); }
        .btn-ai { background: #fff; color: #000; transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1); }
        .btn-ai:hover:not(:disabled) { transform: translateY(-2px); background: #f5f5f7; }
        .invoice-box { background: rgba(255, 255, 255, 0.02); border: 1px dashed rgba(255, 255, 255, 0.15); border-radius: 24px; font-family: 'JetBrains Mono', monospace; padding: 1.5rem; }
        .tip-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 24px; padding: 1.25rem 1.5rem; transition: all 0.5s ease; opacity: 0; transform: translateY(10px); cursor: pointer; overflow: hidden; max-height: 85px; position: relative; }
        .tip-card.show { opacity: 1; transform: translateY(0); }
        .tip-card.expanded { max-height: 700px; background: rgba(255, 255, 255, 0.07); border-color: rgba(0, 113, 227, 0.4); padding-bottom: 2rem; }
        .tip-card.premium-tip { border-color: rgba(168, 85, 247, 0.4); background: linear-gradient(145deg, rgba(255, 255, 255, 0.04) 0%, rgba(168, 85, 247, 0.02) 100%); }
        .loader { width: 40px; height: 40px; border: 3px solid rgba(255, 255, 255, 0.1); border-top-color: #0071e3; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6 bg-[#050505]">

    <div class="apple-container">
        <div class="text-center mb-10">
            <div class="w-14 h-14 bg-white rounded-2xl mx-auto flex items-center justify-center mb-6 shadow-xl">
                <i class="fa-solid fa-wand-magic-sparkles text-black text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold tracking-tighter mb-2">Estratega IA</h1>
            <p class="text-sm text-gray-500">Arquitectura web para marcas premium.</p>
        </div>

        <div class="glass-panel p-8 md:p-10">
            <div id="error-box" class="hidden bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-2xl text-[10px] mb-6 text-center leading-relaxed"></div>

            <div id="form-state">
                <div class="space-y-6">
                    <input type="text" id="ownerName" class="input-dark w-full p-4 text-sm" placeholder="Tu Nombre">
                    <input type="text" id="businessNiche" class="input-dark w-full p-4 text-sm" placeholder="Rubro">
                    <textarea id="businessInput" class="input-dark w-full h-32 p-4 text-sm resize-none" placeholder="Descripción del negocio..."></textarea>
                </div>
                <button onclick="generateStrategy()" id="submitBtn" class="btn-ai w-full py-4 rounded-2xl font-bold text-sm mt-8">
                    Diseñar Hoja de Ruta
                </button>
            </div>

            <div id="loading-state" class="hidden py-10 text-center">
                <div class="loader mx-auto mb-6"></div>
                <p class="text-sm text-gray-400">Consultando arquitectura de IA...</p>
            </div>

            <div id="result-state" class="hidden">
                <div id="tips-container" class="space-y-4 mb-8"></div>
                <a id="whatsappBtn" href="#" target="_blank" class="bg-[#25d366] text-white w-full py-4 rounded-2xl font-bold text-sm flex items-center justify-center gap-3">
                    <i class="fa-brands fa-whatsapp"></i> Iniciar vía WhatsApp
                </a>
            </div>
        </div>
    </div>

    <script>
        function showError(msg) {
            const errBox = document.getElementById('error-box');
            // Si el mensaje es un objeto, lo convertimos a texto para evitar [object Object]
            const cleanMsg = typeof msg === 'object' ? JSON.stringify(msg) : msg;
            errBox.innerHTML = `<strong>Diagnóstico Técnico:</strong> ${cleanMsg}`;
            errBox.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function generateStrategy() {
            const name = document.getElementById('ownerName').value.trim();
            const niche = document.getElementById('businessNiche').value.trim();
            const desc = document.getElementById('businessInput').value.trim();

            if (desc.length < 10) { showError("Por favor describe mejor tu negocio."); return; }

            document.getElementById('form-state').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('error-box').classList.add('hidden');

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Cliente: ${name}, Rubro: ${niche}, Negocio: ${desc}` }] }],
                        systemInstruction: { parts: [{ text: "Genera 3 estrategias web exclusivas en JSON: {tips: [{title, desc, benefit, time, icon}]}. Iconos de FontAwesome 6." }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || `Error del servidor: ${response.status}`);
                }

                const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                const jsonResponse = JSON.parse(rawText);
                renderResults({ ...jsonResponse, name, serial: "ES-" + Math.floor(Math.random()*9999) });

            } catch (error) {
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('form-state').classList.remove('hidden');
                showError(error.message);
            }
        }

        function renderResults(data) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('result-state').classList.remove('hidden');
            const container = document.getElementById('tips-container');
            container.innerHTML = '';
            data.tips.forEach((tip, i) => {
                const card = document.createElement('div');
                card.className = `tip-card show ${i === 2 ? 'premium-tip' : ''}`;
                card.innerHTML = `<h3 class="font-bold text-white">${tip.title}</h3><p class="text-xs text-gray-400 mt-2">${tip.desc}</p>`;
                container.appendChild(card);
            });
            document.getElementById('whatsappBtn').href = `https://wa.me/543795041420?text=ID:${data.serial}`;
        }
    </script>
</body>
</html>
